{% load static %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>

    <meta name="keywords" content=""/>
    <meta name="description" content=""/>

    <link rel="stylesheet" type="text/css"
          href="http://yui.yahooapis.com/2.7.0/build/reset-fonts-grids/reset-fonts-grids.css" media="all"/>
    <link rel="stylesheet" type="text/css" href="{% static "css/style.css" %}" media="all"/>

    <style>
        /* Basic Styling - You can customize this further */

        .yui-gf {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .yui-u {
            padding: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .skills-container, .technical-skills-container {
            margin-top: 20px;
        }

        .skills-container .talent, .technical-skills-container .talent {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>

<div id="doc2" class="yui-t7">
    <div id="inner">

        <div id="hd">
            <div class="yui-gc">
                <div class="yui-u first">
                    <h2><input type="text" placeholder="Your name:" name="full_name"></h2>
                    <br>
                    <h2><input type="text" placeholder="Your position:" name="position"></h2>
                </div>

                <div class="yui-u">
                    <div class="contact-info">
                        {#                        <h3><a id="pdf" href="#">Download PDF</a></h3>#}
                        <h3><a><input type="email" placeholder="Your email:" name="email"></a></h3>
                        <br>
                        <h3><input type="text" name="phone_number" placeholder="Your phone number:"></h3>
                    </div><!--// .contact-info -->
                </div>
            </div><!--// .yui-gc -->
        </div><!--// hd -->

        <div id="bd">
            <div id="yui-main">
                <div class="yui-b">

                    <div class="yui-gf">
                        <div class="yui-u first">
                            <h2>Profile</h2>
                        </div>
                        <div class="yui-u">
                            <p class="enlarge">
                                <textarea name="profile" placeholder="About you"></textarea>
                            </p>
                        </div>
                    </div><!--// .yui-gf -->

                    <!-- Skills Management -->
                    <div class="container">
                        <div class="yui-gf">
                            <div class="yui-u first">
                                <h2>Skills</h2>
                            </div>
                            <div class="yui-u">
                                <button id="addSkillBtn">Add Skill</button>
                            </div>
                        </div>
                        <div id="skillsContainer" class="skills-container">
                            <!-- Skills will be added here -->
                        </div>
                    </div>

                    <!-- Modal for Adding/Editing Skills -->
                    <div id="skillModal" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="closeModal()">&times;</span>
                            <h2>Skill Details</h2>
                            <input type="hidden" id="skillId">
                            <label for="skillName">Skill Name:</label>
                            <input type="text" id="skillName" required><br><br>
                            <label for="skillDescription">Description:</label>
                            <textarea id="skillDescription" rows="4"></textarea><br><br>
                            <button onclick="saveSkill()">Save</button>
                        </div>
                    </div>
                    <!-- Technical Management -->
                    <div class="container">
                        <div class="yui-gf">
                            <div class="yui-u first">
                                <h2>Technical Skills</h2>
                            </div>
                            <div class="yui-u">
                                <button id="addTechnicalSkillBtn">Add Technical Skill</button>
                            </div>
                        </div>
                        <div id="technicalSkillsContainer" class="technical-skills-container">
                            <!-- Technical Skills will be added here -->
                        </div>
                    </div>

                    <!-- Modal for Adding/Editing Technical Skills -->
                    <div id="technicalSkillModal" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="closeTechnicalSkillModal()">&times;</span>
                            <h2>Technical Skill Details</h2>
                            <input type="hidden" id="technicalSkillId">
                            <label for="technicalSkillName">Skill Name:</label>
                            <input type="text" id="technicalSkillName" required><br><br>
                            <button onclick="saveTechnicalSkill()">Save</button>
                        </div>
                    </div>

                    <!-- Add this to your existing HTML in the appropriate place -->
                    <!-- Experience Management -->
                    <div class="container">
                        <div class="yui-gf">
                            <div class="yui-u first">
                                <h2>Experience</h2>
                            </div>
                            <div class="yui-u">
                                <button id="addExperienceBtn">Add Experience</button>
                            </div>
                        </div>
                        <div id="experienceContainer" class="experience-container">
                            <!-- Experience entries will be added here -->
                        </div>
                    </div>

                    <!-- Modal for Adding/Editing Experience -->
                    <div id="experienceModal" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="closeExperienceModal()">&times;</span>
                            <h2>Experience Details</h2>
                            <input type="hidden" id="experienceId">
                            <label for="companyName">Company Name:</label>
                            <input type="text" id="companyName" required><br><br>
                            <label for="role">Role:</label>
                            <input type="text" id="role" required><br><br>
                            <label for="experienceDescription">Description:</label>
                            <textarea id="experienceDescription" rows="4" required></textarea><br><br>
                            <label for="dates">Date:</label>
                            <input type="text" id="dates" required placeholder="e.g., 2005-2007"><br><br>
                            <button onclick="saveExperience()">Save</button>
                        </div>
                    </div>

                    <!-- Education Management -->
                    <div class="container">
                        <div class="yui-gf">
                            <div class="yui-u first">
                                <h2>Education</h2>
                            </div>
                            <div class="yui-u">
                                <button id="addEducationBtn">Add Education</button>
                            </div>
                        </div>
                        <div id="educationContainer" class="education-container">
                            <!-- Education entries will be added here -->
                        </div>
                    </div>

                    <!-- Modal for Adding/Editing Education -->
                    <div id="educationModal" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="closeEducationModal()">&times;</span>
                            <h2>Education Details</h2>
                            <input type="hidden" id="educationId">
                            <label for="universityName">University Name:</label>
                            <input type="text" id="universityName" required><br><br>
                            <label for="major">Major:</label>
                            <input type="text" id="major" required><br><br>
                            <label for="gpa">GPA:</label>
                            <input type="text" id="gpa" required><br><br>
                            <button onclick="saveEducation()">Save</button>
                        </div>
                    </div>
                    <div align="center">
                        <button style="font-weight: bold" class="btn btn-danger" id="submitBtn">Submit</button>
                    </div>
                </div><!--// .yui-b -->
            </div><!--// yui-main -->
        </div><!--// bd -->
    </div><!-- // inner -->


</div><!--// doc -->

<script>
    async function submitData() {
        const resumeData = {
            fullName: document.querySelector('input[name="full_name"]').value,
            position: document.querySelector('input[name="position"]').value,
            email: document.querySelector('input[name="email"]').value,
            phone: document.querySelector('input[name="phone_number"]').value,
            profile: document.querySelector('textarea[name="profile"]').value,
            skills: skillsData,                // Assuming skillsData is defined globally
            technicalSkills: technicalSkillsData, // Assuming technicalSkillsData is defined globally
            experiences: experienceData,        // Assuming experienceData is defined globally
            educations: educationData           // Assuming educationData is defined globally
        };

        try {
            const response = await fetch('/resume/creation', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(resumeData)
            });

            if (!response.ok) {
                throw new Error('Network response was not ok: ' + response.statusText);
            }

            const result = await response.json();
            // Handle success response (e.g. notify user, reset fields)
            console.log('Success:', result);
        } catch (error) {
            // Handle error response
            console.error('Error:', error);
        }
    }

    // You can then call this function when you want to submit the data,
    // e.g., via a button click.
    document.getElementById('submitBtn').addEventListener('click', submitData);
</script>

<script>
    // Get DOM Elements
    const skillsContainer = document.getElementById('skillsContainer');
    const addSkillBtn = document.getElementById('addSkillBtn');
    const skillModal = document.getElementById('skillModal');
    const closeModalBtn = document.querySelector('.close');
    const skillNameInput = document.getElementById('skillName');
    const skillDescriptionInput = document.getElementById('skillDescription');
    const skillIdInput = document.getElementById('skillId');

    // Function to close the modal
    function closeModal() {
        skillModal.style.display = 'none';
        // Clear inputs after closing
        skillNameInput.value = '';
        skillDescriptionInput.value = '';
        skillIdInput.value = '';
    }

    // Function to open the modal
    function openModal(skillId = null) {
        if (skillId) {
            // **Call getSkill AFTER skillsData is populated**
            renderSkills(); // Make sure skillsData is rendered first
            const skill = getSkill(skillId);
            if (skill) { // Check if skill is found
                skillNameInput.value = skill.name;
                skillDescriptionInput.value = skill.description;
                skillIdInput.value = skillId;
            } else {
                console.error("Skill with ID:", skillId, "not found.");
            }
        } else {
            // ... (rest of your code)
        }
        skillModal.style.display = 'block';
    }

    // Function to save/update a skill
    function saveSkill() {
        const skillId = skillIdInput.value; // Get existing ID
        const skillName = skillNameInput.value;
        const skillDescription = skillDescriptionInput.value;

        if (!skillName || !skillDescription) {
            alert("Please fill in all fields.");
            return;
        }

        // Only add a new skill if the ID isn't already set
        if (skillId) {
            // We update existing skill
            updateSkill(skillId, skillName, skillDescription); // Use the same ID
        } else {
            // Adding a new skill, create a new ID
            addSkill(skillName, skillDescription);
        }

        // Close the modal after saving
        closeModal();
    }


    // Functions to manage skills data (replace with your actual storage mechanism)
    let skillsData = []; // Example - using an array in-memory

    function addSkill(name, description) {
        const newSkill = {id: Date.now(), name, description}; // Generate a unique ID
        skillsData.push(newSkill);
        renderSkills();
    }

    function updateSkill(id, name, description) {
        // Make sure id is parsed correctly
        const skillIndex = skillsData.findIndex(skill => skill.id === parseInt(id));
        if (skillIndex !== -1) {
            // Use the existing ID and just update the name and description
            skillsData[skillIndex].name = name;
            skillsData[skillIndex].description = description;
            renderSkills();
        }
    }

    function deleteSkill(id) {
        const skillIndex = skillsData.findIndex(skill => skill.id === parseInt(id));
        if (skillIndex !== -1) {
            skillsData.splice(skillIndex, 1);
            renderSkills();
        }
    }

    function getSkill(id) {
        return skillsData.find(skill => skill.id === parseInt(id));
    }

    // Function to render the skills on the page
    function renderSkills() {
        skillsContainer.innerHTML = ''; // Clear existing skills

        skillsData.forEach(skill => {
            const skillElement = document.createElement('div');
            skillElement.classList.add('talent');

            skillElement.innerHTML = `
                <h2>${skill.name}</h2>
                <p>${skill.description}</p>
                <button onclick="openModal(${skill.id})">Edit</button>
                <button onclick="deleteSkill(${skill.id})">Delete</button>
                `;
            skillsContainer.appendChild(skillElement);
        });
    }

    // Event Listeners
    addSkillBtn.addEventListener('click', openModal);
    closeModalBtn.addEventListener('click', closeModal);

    // Initial rendering of skills (if you have any pre-existing skills)
    renderSkills();
</script>
<script>
    // Get DOM Elements for Technical Skills
    const technicalSkillsContainer = document.getElementById('technicalSkillsContainer');
    const addTechnicalSkillBtn = document.getElementById('addTechnicalSkillBtn');
    const technicalSkillModal = document.getElementById('technicalSkillModal');
    const closeTechnicalSkillModalBtn = document.querySelector('.close');
    const technicalSkillNameInput = document.getElementById('technicalSkillName');
    const technicalSkillIdInput = document.getElementById('technicalSkillId');

    // Technical Skills data array
    let technicalSkillsData = [];

    // Function to close the technical skill modal
    function closeTechnicalSkillModal() {
        technicalSkillModal.style.display = 'none';
        // Clear inputs after closing
        technicalSkillNameInput.value = '';
        technicalSkillIdInput.value = '';
    }

    // Function to open the technical skill modal
    function openTechnicalSkillModal(technicalSkillId = null) {
        if (technicalSkillId) {
            const skill = getTechnicalSkill(technicalSkillId);
            if (skill) {
                technicalSkillNameInput.value = skill.name;
                technicalSkillIdInput.value = technicalSkillId;
            }
        }
        technicalSkillModal.style.display = 'block';
    }

    // Function to save/update a technical skill
    function saveTechnicalSkill() {
        const technicalSkillId = technicalSkillIdInput.value;
        const technicalSkillName = technicalSkillNameInput.value;
        if (!technicalSkillName) {
            alert("Please fill in all fields.");
            return;
        }

        // Store/update technical skill
        if (technicalSkillId) {
            updateTechnicalSkill(technicalSkillId, technicalSkillName);
        } else {
            addTechnicalSkill(technicalSkillName);
        }

        // Close the modal
        closeTechnicalSkillModal();
    }

    function addTechnicalSkill(name, description) {
        const newTechnicalSkill = {id: Date.now(), name, description}; // Generate a unique ID
        technicalSkillsData.push(newTechnicalSkill);
        renderTechnicalSkills();
    }

    function updateTechnicalSkill(id, name, description) {
        const skillIndex = technicalSkillsData.findIndex(skill => skill.id === parseInt(id, 10)); // Ensure you're parsing the ID as an integer
        if (skillIndex !== -1) {
            technicalSkillsData[skillIndex] = {id: parseInt(id, 10), name, description}; // Make sure the id is set correctly
            renderTechnicalSkills();
        }
    }

    function deleteTechnicalSkill(id) {
        const skillIndex = technicalSkillsData.findIndex(skill => skill.id === parseInt(id, 10)); // Ensure you're parsing the ID as an integer
        if (skillIndex !== -1) {
            technicalSkillsData.splice(skillIndex, 1);
            renderTechnicalSkills();
        }
    }

    function getTechnicalSkill(id) {
        return technicalSkillsData.find(skill => skill.id === parseInt(id, 10)); // Ensure you're parsing the ID properly
    }

    // Function to render the technical skills on the page
    function renderTechnicalSkills() {
        technicalSkillsContainer.innerHTML = ''; // Clear existing technical skills

        technicalSkillsData.forEach(skill => {
            const skillElement = document.createElement('div');
            skillElement.classList.add('talent');

            skillElement.innerHTML = `
                <h2>${skill.name}</h2>
                <button onclick="openTechnicalSkillModal(${skill.id})">Edit</button>
                <button onclick="deleteTechnicalSkill(${skill.id})">Delete</button>
            `;
            technicalSkillsContainer.appendChild(skillElement);
        });
    }

    // Event Listeners for Technical Skills
    addTechnicalSkillBtn.addEventListener('click', openTechnicalSkillModal);
    closeTechnicalSkillModalBtn.addEventListener('click', closeTechnicalSkillModal);

    // Initial rendering of technical skills (if you have any pre-existing technical skills)
    renderTechnicalSkills();
</script>
<script>
    // Get DOM Elements for Experience
    const experienceContainer = document.getElementById('experienceContainer');
    const addExperienceBtn = document.getElementById('addExperienceBtn');
    const experienceModal = document.getElementById('experienceModal');
    const closeExperienceModalBtn = document.querySelector('.close');
    const companyNameInput = document.getElementById('companyName');
    const roleInput = document.getElementById('role');
    const experienceDescriptionInput = document.getElementById('experienceDescription');
    const datesInput = document.getElementById('dates');
    const experienceIdInput = document.getElementById('experienceId');

    // Experience data array
    let experienceData = [];

    // Function to close the experience modal
    function closeExperienceModal() {
        experienceModal.style.display = 'none';
        // Clear inputs after closing
        companyNameInput.value = '';
        roleInput.value = '';
        experienceDescriptionInput.value = '';
        datesInput.value = '';
        experienceIdInput.value = '';
    }

    // Function to open the experience modal
    function openExperienceModal(experienceId = null) {
        if (experienceId) {
            const experience = getExperience(experienceId);
            if (experience) {
                companyNameInput.value = experience.company_name;
                roleInput.value = experience.role;
                experienceDescriptionInput.value = experience.description;
                datesInput.value = experience.dates;
                experienceIdInput.value = experienceId;
            }
        }
        experienceModal.style.display = 'block';
    }

    // Function to save/update an experience
    function saveExperience() {
        const experienceId = experienceIdInput.value;
        const company_name = companyNameInput.value;
        const role = roleInput.value;
        const description = experienceDescriptionInput.value;
        const dates = datesInput.value;

        if (!company_name || !role || !description || !dates) {
            alert("Please fill in all fields.");
            return;
        }

        if (experienceId) {
            updateExperience(experienceId, company_name, role, description, dates);
        } else {
            addExperience(company_name, role, description, dates);
        }

        closeExperienceModal();
    }

    function addExperience(company_name, role, description, dates) {
        const newExperience = {id: Date.now(), company_name, role, description, dates};
        experienceData.push(newExperience);
        renderExperience();
    }

    function updateExperience(id, company, role, description, dates) {
        const experienceIndex = experienceData.findIndex(exp => exp.id === parseInt(id));
        if (experienceIndex !== -1) {
            experienceData[experienceIndex] = {id: parseInt(id), company, role, description, dates};
            renderExperience();
        }
    }

    function deleteExperience(id) {
        const experienceIndex = experienceData.findIndex(exp => exp.id === parseInt(id));
        if (experienceIndex !== -1) {
            experienceData.splice(experienceIndex, 1);
            renderExperience();
        }
    }

    function getExperience(id) {
        return experienceData.find(exp => exp.id === parseInt(id));
    }

    // Function to render the experience entries on the page
    function renderExperience() {
        experienceContainer.innerHTML = '';

        experienceData.forEach(exp => {
            const expElement = document.createElement('div');
            expElement.classList.add('talent');

            expElement.innerHTML = `
            <h2>${exp.company}</h2>
            <h3>${exp.role}</h3>
            <h4>${exp.dates}</h4>
            <p>${exp.description}</p>
            <button onclick="openExperienceModal(${exp.id})">Edit</button>
            <button onclick="deleteExperience(${exp.id})">Delete</button>
        `;
            experienceContainer.appendChild(expElement);
        });
    }

    // Event Listeners for Experience
    addExperienceBtn.addEventListener('click', openExperienceModal);
    closeExperienceModalBtn.addEventListener('click', closeExperienceModal);

    // Initial rendering of experience (if you have any pre-existing experience)
    renderExperience();
</script>

<script>
    // Get DOM Elements for Education
    const educationContainer = document.getElementById('educationContainer');
    const addEducationBtn = document.getElementById('addEducationBtn');
    const educationModal = document.getElementById('educationModal');
    const closeEducationModalBtn = document.querySelector('.close');
    const universityNameInput = document.getElementById('universityName');
    const majorInput = document.getElementById('major');
    const gpaInput = document.getElementById('gpa');
    const educationIdInput = document.getElementById('educationId');

    // Education data array
    let educationData = [];

    // Function to close the education modal
    function closeEducationModal() {
        educationModal.style.display = 'none';
        // Clear inputs after closing
        universityNameInput.value = '';
        majorInput.value = '';
        gpaInput.value = '';
        educationIdInput.value = '';
    }

    // Function to open the education modal
    function openEducationModal(educationId = null) {
        if (educationId) {
            const education = getEducation(educationId);
            if (education) {
                universityNameInput.value = education.university_name;
                majorInput.value = education.major;
                gpaInput.value = education.gpa;
                educationIdInput.value = educationId;
            }
        }
        educationModal.style.display = 'block';
    }

    // Function to save/update an education entry
    function saveEducation() {
        const educationId = educationIdInput.value;
        const university_name = universityNameInput.value;
        const major = majorInput.value;
        const gpa = gpaInput.value;

        if (!university_name || !major || !gpa) {
            alert("Please fill in all fields.");
            return;
        }

        // Store/update education entry
        if (educationId) {
            updateEducation(educationId, university_name, major, gpa);
        } else {
            addEducation(university_name, major, gpa);
        }

        // Close the modal
        closeEducationModal();
    }

    function addEducation(university_name, major, gpa) {
        const newEducation = {id: Date.now(), university_name, major, gpa}; // Generate a unique ID
        educationData.push(newEducation);
        renderEducation();
    }

    function updateEducation(id, university_name, major, gpa) {
        const index = educationData.findIndex(ed => ed.id === parseInt(id, 10)); // Ensure you're parsing the ID as an integer
        if (index !== -1) {
            educationData[index] = {id: parseInt(id, 10), university_name, major, gpa}; // Make sure the id is set correctly
            renderEducation();
        }
    }

    function deleteEducation(id) {
        const index = educationData.findIndex(ed => ed.id === parseInt(id, 10)); // Ensure you're parsing the ID as an integer
        if (index !== -1) {
            educationData.splice(index, 1);
            renderEducation();
        }
    }

    function getEducation(id) {
        return educationData.find(ed => ed.id === parseInt(id, 10)); // Ensure you're parsing the ID properly
    }

    // Function to render the education on the page
    function renderEducation() {
        educationContainer.innerHTML = ''; // Clear existing education entries

        educationData.forEach(ed => {
            const edElement = document.createElement('div');
            edElement.classList.add('talent');

            edElement.innerHTML = `
            <h2>${ed.university}</h2>
            <h3>${ed.major} &mdash; <strong>${ed.gpa}</strong></h3>
            <button onclick="openEducationModal(${ed.id})">Edit</button>
            <button onclick="deleteEducation(${ed.id})">Delete</button>
        `;
            educationContainer.appendChild(edElement);
        });
    }

    // Event Listeners for Education
    addEducationBtn.addEventListener('click', openEducationModal);
    closeEducationModalBtn.addEventListener('click', closeEducationModal);

    // Initial rendering of education (if you have any pre-existing education)
    renderEducation();
</script>
</body>
</html>


